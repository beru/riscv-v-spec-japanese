

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. ベクトル要素のベクトルレジスタへの割り付け &mdash; riscv-v-spec-japanese  ドキュメント</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'ja',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="5. ベクトル命令フォーマット" href="chapter5_vector_instruction_format.html" />
    <link rel="prev" title="RISC-V “V” Extension" href="chapter1_3_riscv_vector_insts.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> riscv-v-spec-japanese
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="chapter1_3_riscv_vector_insts.html">RISC-V “V” Extension</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. ベクトル要素のベクトルレジスタへの割り付け</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#lmul-1">4.1 LMUL=1のマッピング</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">4.2. LMUL &gt; 1のマッピング</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mixed-width">4.3. Mixed-Width演算へのマッピング</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">4.4. マスクレジスタのレイアウト</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id4">5. ベクトル命令フォーマット</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id5">5.1. スカラオペランド</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">5.2. ベクトルオペランド</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">5.3 ベクトルマスク</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">5.3.1. マスクのエンコーディング</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id9">5.4 プリスタート・アクティブ・インアクティブ・ボディー・テールの要素定義</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="chapter5_vector_instruction_format.html">5. ベクトル命令フォーマット</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">riscv-v-spec-japanese</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>4. ベクトル要素のベクトルレジスタへの割り付け</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/chapter4_mapping_vector_elements.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>4. ベクトル要素のベクトルレジスタへの割り付け<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>以下の図は、ELEN,
VLENの実装と同様に、現在のSEWおよびLMULの設定に基づいてベクトルレジスタのバイトをどのようにして異なるサイズのベクトル要素にパックするかについて説明している。要素は、最下位のビットの中で最も重要度の低いバイトを持つ各ベクトルレジスタにパックされる。</p>
<p>Elements are packed into each vector register with the least-significant
byte in the lowest-numbered bits.</p>
<blockquote>
<div>以前のRISC-V Vector
Proposal(&lt;0.6)ではこのマッピングをソフトウェアから隠していたが、今回のProposalではすべての構成について具体的なマッピングについて説明している。これにより実装の柔軟性が失われるが、コンフィグレーションが変更されることによりゼロ埋めの必要性が除去される。マッピングを明示することにより、明示的なコンテキストの保存・回復コードを簡単化することができる。つまりコンフィグレーションを読み込まずにすべてのベクトルレジスタを保存するのではなく、<code class="docutils literal notranslate"><span class="pre">vl</span></code>,<code class="docutils literal notranslate"><span class="pre">vtype</span></code>を保存して、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>を便利な値にリセットする(例えば、LMUL=8,
SEW=ELENとする4つのベクトルグループ)ことができる。この逆の処理を行えば、ベクトルの状態を回復させることができる。</div></blockquote>
<div class="section" id="lmul-1">
<h2>4.1 LMUL=1のマッピング<a class="headerlink" href="#lmul-1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>LMUL=1の場合、要素はベクトルレジスタに対して単純に最下位から最上位に向けてパッキングされる。</p>
<blockquote>
<div>可読性を向上させるために、ベクトルレジスタのレイアウトはバイトサイズで右から左にバイトアドレスを増加させる形式でく述する。エレメント内のビットはリトルエンディアンの形式で記述し、ビットインデックスは右から左へと増加していく。</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>要素のインデックは16進数で記述し、格納されている要素のうち最も下位の位置に記述している。ELEN&lt;=128かつLMUL=1である。

 VLEN=32b

 Byte         3 2 1 0

 SEW=8b       3 2 1 0
 SEW=16b        1   0
 SEW=32b            0

 VLEN=64b

 Byte        7 6 5 4 3 2 1 0

 SEW=8b      7 6 5 4 3 2 1 0
 SEW=16b       3   2   1   0
 SEW=32b           1       0
 SEW=64b                   0

 VLEN=128b

 Byte        F E D C B A 9 8 7 6 5 4 3 2 1 0

 SEW=8b      F E D C B A 9 8 7 6 5 4 3 2 1 0
 SEW=16b       7   6   5   4   3   2   1   0
 SEW=32b           3       2       1       0
 SEW=64b                   1               0
 SEW=128b                                  0

 VLEN=256b

 Byte     1F1E1D1C1B1A19181716151413121110 F E D C B A 9 8 7 6 5 4 3 2 1 0

 SEW=8b   1F1E1D1C1B1A19181716151413121110 F E D C B A 9 8 7 6 5 4 3 2 1 0
 SEW=16b     F   E   D   C   B   A   9   8   7   6   5   4   3   2   1   0
 SEW=32b         7       6       5       4       3       2       1       0
 SEW=64b                 3               2               1               0
 SEW=128b                                1                               0
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>4.2. LMUL &gt; 1のマッピング<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトルレジスタがグループ化されているとき、ベクトルレジスタグループの要素はベクトルレジスタでストライプして配置される。ストライプの距離はSLENビットで表現され、グループ内で1つのベクトルレジスタ内で何ビットが1つの要素としてパッキングされているかを示している。</p>
<p>例えば、SLEN=128のとき、ストライプのパタンは128ビットの倍数である。最初の128/SEW個の要素はグループ内で最初のベクトルレジスタのスタート位置から連続してパッキングされる。次の128/SEW要素は連続してグループ内で次のベクトルレジスタのスタート位置から連続してパッキングされる。最初のLMUL*128/SEW個の要素をパッキングすると、次のLMUL*128/SEW個の要素のグループは次の128ビットのセグメントとしてグループ内のベクトルレジスタでパッキングされる。これが続く。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">例1</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">16</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span>

<span class="n">Byte</span>         <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span>           <span class="mi">1</span>   <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>         <span class="mi">3</span>   <span class="mi">2</span>

<span class="n">例2</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">64</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span>

<span class="n">Byte</span>         <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span>               <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>             <span class="mi">3</span>       <span class="mi">2</span>

<span class="n">例3</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span>

<span class="n">Byte</span>        <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span>              <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>            <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>

<span class="n">例4</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span>

<span class="n">Byte</span>     <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span>            <span class="n">B</span>       <span class="n">A</span>       <span class="mi">9</span>       <span class="mi">8</span>       <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>          <span class="n">F</span>       <span class="n">E</span>       <span class="n">D</span>       <span class="n">C</span>       <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>
</pre></div>
</div>
<p>SEW&gt;
SLENの場合、ストライピングパターンは、グループ内の次のベクトルレジスタに移動する前に、グループ内の各ベクトルレジスタに1つの要素を配置する。
したがって、LMUL=2の場合、偶数ベクトルレジスタにはベクトルの偶数要素が含まれ、奇数ベクトルレジスタにはベクトルの奇数要素が含まれます。</p>
<blockquote>
<div>ほとんどの実装では、SLEN≥ELENである。</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">例</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span>

<span class="n">Byte</span>     <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span>                                                                    <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>                                                                  <span class="mi">1</span>
</pre></div>
</div>
<p>LMUL=4では、ベクトルレジスタは以下のように要素を格納する。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">例1</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">16</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>

<span class="n">Byte</span>         <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span>           <span class="mi">1</span>   <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>         <span class="mi">3</span>   <span class="mi">2</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>         <span class="mi">5</span>   <span class="mi">4</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>         <span class="mi">7</span>   <span class="mi">6</span>

<span class="n">例2</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">64</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">64</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span>

<span class="n">Byte</span>         <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span>               <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>             <span class="mi">3</span>       <span class="mi">2</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>             <span class="mi">5</span>       <span class="mi">4</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>             <span class="mi">7</span>       <span class="mi">6</span>


<span class="n">例3</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">64</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span>

<span class="n">Byte</span>          <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span>                <span class="mi">9</span>       <span class="mi">8</span>       <span class="mi">1</span>       <span class="mi">0</span>   <span class="mi">32</span><span class="n">b</span> <span class="n">elements</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>              <span class="n">B</span>       <span class="n">A</span>       <span class="mi">3</span>       <span class="mi">2</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>              <span class="n">D</span>       <span class="n">C</span>       <span class="mi">5</span>       <span class="mi">4</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>              <span class="n">F</span>       <span class="n">E</span>       <span class="mi">7</span>       <span class="mi">6</span>

<span class="n">例4</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span>

<span class="n">Byte</span>          <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span>                <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>   <span class="mi">32</span><span class="n">b</span> <span class="n">elements</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>              <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>              <span class="n">B</span>       <span class="n">A</span>       <span class="mi">9</span>       <span class="mi">8</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>              <span class="n">F</span>       <span class="n">E</span>       <span class="n">D</span>       <span class="n">C</span>

<span class="n">例5</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span>

<span class="n">Byte</span>     <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span>           <span class="mi">13</span>      <span class="mi">12</span>      <span class="mi">11</span>      <span class="mi">10</span>       <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>         <span class="mi">17</span>      <span class="mi">16</span>      <span class="mi">15</span>      <span class="mi">14</span>       <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>         <span class="mi">1</span><span class="n">B</span>      <span class="mi">1</span><span class="n">A</span>      <span class="mi">19</span>      <span class="mi">18</span>       <span class="n">B</span>       <span class="n">A</span>       <span class="mi">9</span>       <span class="mi">8</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>         <span class="mi">1</span><span class="n">F</span>      <span class="mi">1</span><span class="n">E</span>      <span class="mi">1</span><span class="n">D</span>      <span class="mi">1</span><span class="n">C</span>       <span class="n">F</span>       <span class="n">E</span>       <span class="n">D</span>       <span class="n">C</span>

<span class="n">例6</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span>

<span class="n">Byte</span>     <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span>                                                                    <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>                                                                  <span class="mi">1</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>                                                                  <span class="mi">2</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>                                                                  <span class="mi">3</span>
</pre></div>
</div>
<p>似たようなパタンで、LMUL=8の場合である。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">例</span><span class="p">:</span> <span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span><span class="p">,</span> <span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">8</span>

<span class="n">Byte</span>   <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span>         <span class="mi">23</span>      <span class="mi">22</span>      <span class="mi">21</span>      <span class="mi">20</span>       <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>       <span class="mi">27</span>      <span class="mi">26</span>      <span class="mi">25</span>      <span class="mi">24</span>       <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>       <span class="mi">2</span><span class="n">B</span>      <span class="mi">2</span><span class="n">A</span>      <span class="mi">29</span>      <span class="mi">28</span>       <span class="n">B</span>       <span class="n">A</span>       <span class="mi">9</span>       <span class="mi">8</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>       <span class="mi">2</span><span class="n">F</span>      <span class="mi">2</span><span class="n">E</span>      <span class="mi">2</span><span class="n">D</span>      <span class="mi">2</span><span class="n">C</span>       <span class="n">F</span>       <span class="n">E</span>       <span class="n">D</span>       <span class="n">C</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">4</span>       <span class="mi">33</span>      <span class="mi">32</span>      <span class="mi">31</span>      <span class="mi">30</span>      <span class="mi">13</span>      <span class="mi">12</span>      <span class="mi">11</span>      <span class="mi">10</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">5</span>       <span class="mi">37</span>      <span class="mi">36</span>      <span class="mi">35</span>      <span class="mi">34</span>      <span class="mi">17</span>      <span class="mi">16</span>      <span class="mi">15</span>      <span class="mi">14</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">6</span>       <span class="mi">3</span><span class="n">B</span>      <span class="mi">3</span><span class="n">A</span>      <span class="mi">39</span>      <span class="mi">38</span>      <span class="mi">1</span><span class="n">B</span>      <span class="mi">1</span><span class="n">A</span>      <span class="mi">19</span>      <span class="mi">18</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">7</span>       <span class="mi">3</span><span class="n">F</span>      <span class="mi">3</span><span class="n">E</span>      <span class="mi">3</span><span class="n">D</span>      <span class="mi">3</span><span class="n">C</span>      <span class="mi">1</span><span class="n">F</span>      <span class="mi">1</span><span class="n">E</span>      <span class="mi">1</span><span class="n">D</span>      <span class="mi">1</span><span class="n">C</span>
</pre></div>
</div>
<p>アーキテクチャ上はさまざまなストライピングパターンが表示されるが、ストライピングパターンに関係なく同じ結果を生成するソフトウェアを作成できる。
主な制約は、ベクトルレジスタグループに保持されている値にアクセスするために使用されるLMULを変更しないことである(つまり、グループに値を書き込むために使用されるものとは異なるLMULで値を読み取らない)。</p>
<blockquote>
<div>実装のストライピング長SLENは、幅が広いユニットのストライドメモリアクセスをベクターレジスタファイルの並列アクセスにコーナーターンするために必要な、幅の異なる操作のデータパス配線とバッファリングのトレードオフを最適化するように設定される。</div></blockquote>
<blockquote>
<div>以前の明示的なコンフィグレーションデザインでは、これらのトレードオフをマイクロアーキテクチャレベルで管理し、構成ごとに最適化することができた。</div></blockquote>
</div>
<div class="section" id="mixed-width">
<h2>4.3. Mixed-Width演算へのマッピング<a class="headerlink" href="#mixed-width" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトルレジスタグループ内の要素をマップするために使用されるパターンは、複数の要素幅にわたる操作をサポートするときにデータパスの配線を減らすように設計されている。
この場合の推奨されているソフトウェア戦略は、
<code class="docutils literal notranslate"><span class="pre">vtype</span></code>を動的に変更して、SEW /
LMULを一定に(つまりVLMAXを一定に)維持することである。</p>
<p>次の例は、VLEN=256b /
SLEN=128bの実装における4つの異なるパッキング要素の幅(8b,16b,32b,64b)を示している。
ベクトルレジスタグループ化係数(LMUL)は、各要素が同じ数のベクトル要素(この例では32)を保持できるように相対的な要素サイズによって増加し、ストリップマイニングコードを簡素化する。
同じインデックスを持つ要素間の操作は、データパスの同じ128b部分にあるオペランドビットにのみ影響する。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span>
<span class="n">Byte</span>     <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">8</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v1</span>       <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">16</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v2</span><span class="o">*</span><span class="n">n</span>       <span class="mi">17</span>  <span class="mi">16</span>  <span class="mi">15</span>  <span class="mi">14</span>  <span class="mi">13</span>  <span class="mi">12</span>  <span class="mi">11</span>  <span class="mi">10</span>   <span class="mi">7</span>   <span class="mi">6</span>   <span class="mi">5</span>   <span class="mi">4</span>   <span class="mi">3</span>   <span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">0</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>     <span class="mi">1</span><span class="n">F</span>  <span class="mi">1</span><span class="n">E</span>  <span class="mi">1</span><span class="n">D</span>  <span class="mi">1</span><span class="n">C</span>  <span class="mi">1</span><span class="n">B</span>  <span class="mi">1</span><span class="n">A</span>  <span class="mi">19</span>  <span class="mi">18</span>   <span class="n">F</span>   <span class="n">E</span>   <span class="n">D</span>   <span class="n">C</span>   <span class="n">B</span>   <span class="n">A</span>   <span class="mi">9</span>   <span class="mi">8</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v4</span><span class="o">*</span><span class="n">n</span>           <span class="mi">13</span>      <span class="mi">12</span>      <span class="mi">11</span>      <span class="mi">10</span>       <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>         <span class="mi">17</span>      <span class="mi">16</span>      <span class="mi">15</span>      <span class="mi">14</span>       <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>         <span class="mi">1</span><span class="n">B</span>      <span class="mi">1</span><span class="n">A</span>      <span class="mi">19</span>      <span class="mi">18</span>       <span class="n">B</span>       <span class="n">A</span>       <span class="mi">9</span>       <span class="mi">8</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>         <span class="mi">1</span><span class="n">F</span>      <span class="mi">1</span><span class="n">E</span>      <span class="mi">1</span><span class="n">D</span>      <span class="mi">1</span><span class="n">C</span>       <span class="n">F</span>       <span class="n">E</span>       <span class="n">D</span>       <span class="n">C</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">64</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v8</span><span class="o">*</span><span class="n">n</span>                   <span class="mi">11</span>              <span class="mi">10</span>               <span class="mi">1</span>               <span class="mi">0</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>                 <span class="mi">13</span>              <span class="mi">12</span>               <span class="mi">3</span>               <span class="mi">2</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>                 <span class="mi">15</span>              <span class="mi">14</span>               <span class="mi">5</span>               <span class="mi">4</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>                 <span class="mi">17</span>              <span class="mi">16</span>               <span class="mi">7</span>               <span class="mi">6</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">4</span>                 <span class="mi">19</span>              <span class="mi">18</span>               <span class="mi">9</span>               <span class="mi">8</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">5</span>                 <span class="mi">1</span><span class="n">B</span>              <span class="mi">1</span><span class="n">A</span>               <span class="n">B</span>               <span class="n">A</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">6</span>                 <span class="mi">1</span><span class="n">D</span>              <span class="mi">1</span><span class="n">C</span>               <span class="n">D</span>               <span class="n">C</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">7</span>                 <span class="mi">1</span><span class="n">F</span>              <span class="mi">1</span><span class="n">E</span>               <span class="n">F</span>               <span class="n">E</span>
</pre></div>
</div>
<p>LMULに大きな値を設定することは、論理的なベクトルレジスタ長を削減しなければならないときに、単純にベクトル長を増加させ、命令フェッチ幅を削減し、ディスパッチのオーバヘッドを削減するために役に立つ。</p>
<p>以下の表は、混合幅動作について、可能なSEW/LMULの動作ポイントについて示している。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      横軸はLMULの値を示し、各軸はSEW/MULの動作ポイントを示している。

SEW/LMUL    1   2   4   8  16  32  64 128 256 512 1024

     SEW
       8    8   4   2   1
      16        8   4   2   1
      32            8   4   2   1
      64                8   4   2   1
     128                    8   4   2   1
     256                        8   4   2   1
     512                            8   4   2   1
    1024                                8   4   2   1
</pre></div>
</div>
<blockquote>
<div><p>SLENが空間データパス幅よりも小さい場合、LMUL値を大きくすると、短いベクトルのデータパス使用率が低くなる。
VLEN=256b、SLEN=128b、およびLMUL=8を使用した上記の例では、実装が256b幅のベクトルデータパスを持つ純粋な空間である場合、アプリケーションベクトル長が17未満の場合、データパスの半分のみがアクティブになる。
以下の「vsetvl」命令には、必要なアプリケーションベクトル長(AVL)と要素幅の範囲に従って適切なLMULを動的に選択する機能を追加できる。</p>
<p>狭いマシンでは、SLENが少なくともデータパスの空間幅と同じ大きさに設定されるため、LMULを減らす必要ない。
幅の広いマシンでは、SLENを空間データパスの幅よりも小さく設定して、幅が混在する操作(例えば、width=1024、ELEN=32、SLEN=128)の配線を減らすことができる。</p>
</div></blockquote>
</div>
<div class="section" id="id3">
<h2>4.4. マスクレジスタのレイアウト<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトルのマスクは、SEWとLMULの値に関係なく1つのベクトルレジスタにのみ適用される。各ベクトル操作に使用されるマスクビットは現在のSEWとLMUL設定に依存する。</p>
<p>ベクトルオペランドの最大エレメント長は以下になる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VLMAX</span> <span class="o">=</span> <span class="n">LMUL</span> <span class="o">*</span> <span class="n">VLEN</span><span class="o">/</span><span class="n">SEW</span>
</pre></div>
</div>
<p>マスクは、マスクレジスタをVLEN/LVMAXフィールドで分割することにより各エレメントに割り当てられる。各マスクエレメントのサイズ<strong>MLEN</strong>は以下で計算できる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MLEN</span> <span class="o">=</span> <span class="n">VLEN</span><span class="o">/</span><span class="n">VLMAX</span>
     <span class="o">=</span> <span class="n">VLEN</span><span class="o">/</span><span class="p">(</span><span class="n">LMUL</span> <span class="o">*</span> <span class="n">VLEN</span><span class="o">/</span><span class="n">SEW</span><span class="p">)</span>
     <span class="o">=</span> <span class="n">SEW</span><span class="o">/</span><span class="n">LMUL</span>
</pre></div>
</div>
<p>MLENはELEN(SEW=ELEN, LMUL=1)から1(SEW=8b,
LMUL=8)までの値を取ることができ、したがって単一のベクトルレジスタは常に全体のマスクレジスタを保持することができる。</p>
<p>マスクビットの要素<em>i</em>はマスクレジスタのビット[MLEN<em>i+(MLEN-1):MLEN</em>i]である。比較命令によりマスクの要素に書き込みが行われた場合、マスクの要素の再開ビットに比較結果が書き込まれ、上位ビットはゼロが設定される。その値がマスクとして読みだされた場合、マスク要素の再開ビットのみがコントロースマスクとして使用され、上位のビットは無視される。現在のベクトル長を超えるマスク要素はゼロとなる。</p>
<p>パターンは、一定のSEW/LMUL値の場合、有効なプレディケートビットがマスクベクトルレジスタの同じビットに配置されるため、幅の異なる要素を含むループでのマスキングの使用が簡単になる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VLEN</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span>

          <span class="n">Byte</span>    <span class="mi">3</span>   <span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">0</span>
 <span class="n">LMUL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">SEW</span><span class="o">=</span><span class="mi">8</span><span class="n">b</span>
                  <span class="mi">3</span>   <span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">0</span>  <span class="n">Element</span>
                <span class="p">[</span><span class="mi">24</span><span class="p">][</span><span class="mi">16</span><span class="p">][</span><span class="mi">08</span><span class="p">][</span><span class="mi">00</span><span class="p">]</span> <span class="n">Mask</span> <span class="n">bit</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">decimal</span>

 <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">SEW</span><span class="o">=</span><span class="mi">16</span><span class="n">b</span>
                      <span class="mi">1</span>       <span class="mi">0</span>
                    <span class="p">[</span><span class="mi">08</span><span class="p">]</span>    <span class="p">[</span><span class="mi">00</span><span class="p">]</span>
                      <span class="mi">3</span>       <span class="mi">2</span>
                    <span class="p">[</span><span class="mi">24</span><span class="p">]</span>    <span class="p">[</span><span class="mi">16</span><span class="p">]</span>

 <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span>               <span class="mi">0</span>
                            <span class="p">[</span><span class="mi">00</span><span class="p">]</span>
                              <span class="mi">1</span>
                            <span class="p">[</span><span class="mi">08</span><span class="p">]</span>
                              <span class="mi">2</span>
                            <span class="p">[</span><span class="mi">16</span><span class="p">]</span>
                              <span class="mi">3</span>
                            <span class="p">[</span><span class="mi">24</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">SEW</span><span class="o">=</span><span class="mi">8</span><span class="n">b</span>
                 <span class="mi">3</span>   <span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">0</span>
               <span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="mi">08</span><span class="p">][</span><span class="mi">04</span><span class="p">][</span><span class="mi">00</span><span class="p">]</span>
                 <span class="mi">7</span>   <span class="mi">6</span>   <span class="mi">5</span>   <span class="mi">4</span>
               <span class="p">[</span><span class="mi">28</span><span class="p">][</span><span class="mi">24</span><span class="p">][</span><span class="mi">20</span><span class="p">][</span><span class="mi">16</span><span class="p">]</span>

<span class="n">LMUL</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span>
                             <span class="mi">0</span>
                           <span class="p">[</span><span class="mi">00</span><span class="p">]</span>
                             <span class="mi">1</span>
                           <span class="p">[</span><span class="mi">04</span><span class="p">]</span>
                             <span class="mi">2</span>
                           <span class="p">[</span><span class="mi">08</span><span class="p">]</span>
                             <span class="mi">3</span>
                           <span class="p">[</span><span class="mi">12</span><span class="p">]</span>
                             <span class="mi">4</span>
                           <span class="p">[</span><span class="mi">16</span><span class="p">]</span>
                             <span class="mi">5</span>
                           <span class="p">[</span><span class="mi">20</span><span class="p">]</span>
                             <span class="mi">6</span>
                           <span class="p">[</span><span class="mi">24</span><span class="p">]</span>
                             <span class="mi">7</span>
                           <span class="p">[</span><span class="mi">28</span><span class="p">]</span>

<span class="n">LMUL</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">SEW</span><span class="o">=</span><span class="mi">8</span><span class="n">b</span>
                 <span class="mi">3</span>   <span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">0</span>
               <span class="p">[</span><span class="mi">03</span><span class="p">][</span><span class="mi">02</span><span class="p">][</span><span class="mi">01</span><span class="p">][</span><span class="mi">00</span><span class="p">]</span>
                 <span class="mi">7</span>   <span class="mi">6</span>   <span class="mi">5</span>   <span class="mi">4</span>
               <span class="p">[</span><span class="mi">07</span><span class="p">][</span><span class="mi">06</span><span class="p">][</span><span class="mi">05</span><span class="p">][</span><span class="mi">04</span><span class="p">]</span>
                 <span class="n">B</span>   <span class="n">A</span>   <span class="mi">9</span>   <span class="mi">8</span>
               <span class="p">[</span><span class="mi">11</span><span class="p">][</span><span class="mi">10</span><span class="p">][</span><span class="mi">09</span><span class="p">][</span><span class="mi">08</span><span class="p">]</span>
                 <span class="n">F</span>   <span class="n">E</span>   <span class="n">D</span>   <span class="n">C</span>
               <span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="mi">14</span><span class="p">][</span><span class="mi">13</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span>
                <span class="mi">13</span>  <span class="mi">12</span>  <span class="mi">11</span>  <span class="mi">10</span>
               <span class="p">[</span><span class="mi">19</span><span class="p">][</span><span class="mi">18</span><span class="p">][</span><span class="mi">17</span><span class="p">][</span><span class="mi">16</span><span class="p">]</span>
                <span class="mi">17</span>  <span class="mi">16</span>  <span class="mi">15</span>  <span class="mi">14</span>
               <span class="p">[</span><span class="mi">23</span><span class="p">][</span><span class="mi">22</span><span class="p">][</span><span class="mi">21</span><span class="p">][</span><span class="mi">20</span><span class="p">]</span>
                <span class="mi">1</span><span class="n">B</span>  <span class="mi">1</span><span class="n">A</span>  <span class="mi">19</span>  <span class="mi">18</span>
               <span class="p">[</span><span class="mi">27</span><span class="p">][</span><span class="mi">26</span><span class="p">][</span><span class="mi">25</span><span class="p">][</span><span class="mi">24</span><span class="p">]</span>
                <span class="mi">1</span><span class="n">F</span>  <span class="mi">1</span><span class="n">E</span>  <span class="mi">1</span><span class="n">D</span>  <span class="mi">1</span><span class="n">C</span>
               <span class="p">[</span><span class="mi">31</span><span class="p">][</span><span class="mi">30</span><span class="p">][</span><span class="mi">29</span><span class="p">][</span><span class="mi">28</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VLEN</span><span class="o">=</span><span class="mi">256</span><span class="n">b</span><span class="p">,</span> <span class="n">SLEN</span><span class="o">=</span><span class="mi">128</span><span class="n">b</span>
<span class="n">Byte</span>     <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">8</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v1</span>       <span class="mi">1</span><span class="n">F1E1D1C1B1A19181716151413121110</span> <span class="n">F</span> <span class="n">E</span> <span class="n">D</span> <span class="n">C</span> <span class="n">B</span> <span class="n">A</span> <span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span>
       <span class="p">[</span><span class="mi">248</span><span class="p">]</span>          <span class="o">...</span>            <span class="p">[</span><span class="mi">128</span><span class="p">]</span> <span class="o">...</span><span class="p">[</span><span class="mi">96</span><span class="p">]</span> <span class="o">...</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">...</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">...</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="n">Mask</span> <span class="n">bit</span> <span class="n">positions</span> <span class="ow">in</span> <span class="n">decimal</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">16</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v2</span><span class="o">*</span><span class="n">n</span>       <span class="mi">17</span>  <span class="mi">16</span>  <span class="mi">15</span>  <span class="mi">14</span>  <span class="mi">13</span>  <span class="mi">12</span>  <span class="mi">11</span>  <span class="mi">10</span>   <span class="mi">7</span>   <span class="mi">6</span>   <span class="mi">5</span>   <span class="mi">4</span>   <span class="mi">3</span>   <span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">0</span>
         <span class="p">[</span><span class="mi">184</span><span class="p">]</span>          <span class="o">...</span>          <span class="p">[</span><span class="mi">128</span><span class="p">]</span>    <span class="o">...</span>     <span class="p">[</span><span class="mi">32</span><span class="p">]</span>    <span class="o">...</span>      <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">v2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>     <span class="mi">1</span><span class="n">F</span>  <span class="mi">1</span><span class="n">E</span>  <span class="mi">1</span><span class="n">D</span>  <span class="mi">1</span><span class="n">C</span>  <span class="mi">1</span><span class="n">B</span>  <span class="mi">1</span><span class="n">A</span>  <span class="mi">19</span>  <span class="mi">18</span>   <span class="n">F</span>   <span class="n">E</span>   <span class="n">D</span>   <span class="n">C</span>   <span class="n">B</span>   <span class="n">A</span>   <span class="mi">9</span>   <span class="mi">8</span>
         <span class="p">[</span><span class="mi">248</span><span class="p">]</span>          <span class="o">...</span>          <span class="p">[</span><span class="mi">196</span><span class="p">]</span>    <span class="o">...</span>     <span class="p">[</span><span class="mi">96</span><span class="p">]</span>    <span class="o">...</span>     <span class="p">[</span><span class="mi">64</span><span class="p">]</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">32</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v4</span><span class="o">*</span><span class="n">n</span>           <span class="mi">13</span>      <span class="mi">12</span>      <span class="mi">11</span>      <span class="mi">10</span>       <span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>
             <span class="p">[</span><span class="mi">152</span><span class="p">]</span>        <span class="o">...</span>        <span class="p">[</span><span class="mi">128</span><span class="p">]</span>    <span class="p">[</span><span class="mi">24</span><span class="p">]</span>        <span class="o">...</span>          <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>         <span class="mi">17</span>      <span class="mi">16</span>      <span class="mi">15</span>      <span class="mi">14</span>       <span class="mi">7</span>       <span class="mi">6</span>       <span class="mi">5</span>       <span class="mi">4</span>
             <span class="p">[</span><span class="mi">184</span><span class="p">]</span>        <span class="o">...</span>        <span class="p">[</span><span class="mi">160</span><span class="p">]</span>    <span class="p">[</span><span class="mi">56</span><span class="p">]</span>        <span class="o">...</span>         <span class="p">[</span><span class="mi">32</span><span class="p">]</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>         <span class="mi">1</span><span class="n">B</span>      <span class="mi">1</span><span class="n">A</span>      <span class="mi">19</span>      <span class="mi">18</span>       <span class="n">B</span>       <span class="n">A</span>       <span class="mi">9</span>       <span class="mi">8</span>
             <span class="p">[</span><span class="mi">116</span><span class="p">]</span>        <span class="o">...</span>        <span class="p">[</span><span class="mi">192</span><span class="p">]</span>    <span class="p">[</span><span class="mi">88</span><span class="p">]</span>        <span class="o">...</span>         <span class="p">[</span><span class="mi">64</span><span class="p">]</span>
<span class="n">v4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>         <span class="mi">1</span><span class="n">F</span>      <span class="mi">1</span><span class="n">E</span>      <span class="mi">1</span><span class="n">D</span>      <span class="mi">1</span><span class="n">C</span>       <span class="n">F</span>       <span class="n">E</span>       <span class="n">D</span>       <span class="n">C</span>
             <span class="p">[</span><span class="mi">248</span><span class="p">]</span>        <span class="o">...</span>        <span class="p">[</span><span class="mi">224</span><span class="p">]</span>   <span class="p">[</span><span class="mi">120</span><span class="p">]</span>        <span class="o">...</span>         <span class="p">[</span><span class="mi">96</span><span class="p">]</span>

<span class="n">SEW</span><span class="o">=</span><span class="mi">64</span><span class="n">b</span><span class="p">,</span> <span class="n">LMUL</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">VLMAX</span><span class="o">=</span><span class="mi">32</span>

<span class="n">v8</span><span class="o">*</span><span class="n">n</span>                   <span class="mi">11</span>              <span class="mi">10</span>               <span class="mi">1</span>               <span class="mi">0</span>
                     <span class="p">[</span><span class="mi">136</span><span class="p">]</span>           <span class="p">[</span><span class="mi">128</span><span class="p">]</span>             <span class="p">[</span><span class="mi">8</span><span class="p">]</span>             <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>                 <span class="mi">13</span>              <span class="mi">12</span>               <span class="mi">3</span>               <span class="mi">2</span>
                     <span class="p">[</span><span class="mi">152</span><span class="p">]</span>           <span class="p">[</span><span class="mi">144</span><span class="p">]</span>            <span class="p">[</span><span class="mi">24</span><span class="p">]</span>            <span class="p">[</span><span class="mi">16</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span>                 <span class="mi">15</span>              <span class="mi">14</span>               <span class="mi">5</span>               <span class="mi">4</span>
                     <span class="p">[</span><span class="mi">168</span><span class="p">]</span>           <span class="p">[</span><span class="mi">160</span><span class="p">]</span>            <span class="p">[</span><span class="mi">40</span><span class="p">]</span>            <span class="p">[</span><span class="mi">32</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span>                 <span class="mi">17</span>              <span class="mi">16</span>               <span class="mi">7</span>               <span class="mi">6</span>
                     <span class="p">[</span><span class="mi">184</span><span class="p">]</span>           <span class="p">[</span><span class="mi">176</span><span class="p">]</span>            <span class="p">[</span><span class="mi">56</span><span class="p">]</span>            <span class="p">[</span><span class="mi">48</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">4</span>                 <span class="mi">19</span>              <span class="mi">18</span>               <span class="mi">9</span>               <span class="mi">8</span>
                     <span class="p">[</span><span class="mi">200</span><span class="p">]</span>           <span class="p">[</span><span class="mi">192</span><span class="p">]</span>            <span class="p">[</span><span class="mi">72</span><span class="p">]</span>            <span class="p">[</span><span class="mi">64</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">5</span>                 <span class="mi">1</span><span class="n">B</span>              <span class="mi">1</span><span class="n">A</span>               <span class="n">B</span>               <span class="n">A</span>
                     <span class="p">[</span><span class="mi">216</span><span class="p">]</span>           <span class="p">[</span><span class="mi">208</span><span class="p">]</span>            <span class="p">[</span><span class="mi">88</span><span class="p">]</span>            <span class="p">[</span><span class="mi">80</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">6</span>                 <span class="mi">1</span><span class="n">D</span>              <span class="mi">1</span><span class="n">C</span>               <span class="n">D</span>               <span class="n">C</span>
                     <span class="p">[</span><span class="mi">232</span><span class="p">]</span>           <span class="p">[</span><span class="mi">224</span><span class="p">]</span>           <span class="p">[</span><span class="mi">104</span><span class="p">]</span>            <span class="p">[</span><span class="mi">96</span><span class="p">]</span>
<span class="n">v8</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">7</span>                 <span class="mi">1</span><span class="n">F</span>              <span class="mi">1</span><span class="n">E</span>               <span class="n">F</span>               <span class="n">E</span>
                     <span class="p">[</span><span class="mi">248</span><span class="p">]</span>           <span class="p">[</span><span class="mi">240</span><span class="p">]</span>           <span class="p">[</span><span class="mi">120</span><span class="p">]</span>           <span class="p">[</span><span class="mi">112</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h1>5. ベクトル命令フォーマット<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>ベクトル拡張命令は既存の4つの命令オペコード(LOAD-FP, STORE-FP,
AMO)および新しいメジャーオペコード(OP-V)を使用している。</p>
<p>ベクトルロードとストア命令は浮動小数点巣からロードストアのメジャーオペコード(LOAD-FP/STORE-FP)でエンコーディングされている。ベクトルロードとストアは標準的なスカラの浮動小数点ロードストア命令の12ビットの即値フィールドを使って、より多くの命令エンコーディングを提供している。ビット25は標準的なベクトルマスクビットを示している(マスクエンコーディングの章を参照のこと)。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOAD</span><span class="o">-</span><span class="n">FPメジャーオペコードを使用したベクトルロード命令のフォーマット</span>
<span class="mi">31</span> <span class="mi">29</span> <span class="mi">28</span> <span class="mi">26</span>  <span class="mi">25</span>  <span class="mi">24</span>      <span class="mi">20</span> <span class="mi">19</span>       <span class="mi">15</span> <span class="mi">14</span>   <span class="mi">12</span> <span class="mi">11</span>      <span class="mi">7</span> <span class="mi">6</span>     <span class="mi">0</span>
 <span class="n">nf</span>  <span class="o">|</span> <span class="n">mop</span> <span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>  <span class="n">lumop</span>   <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">0000111</span><span class="o">|</span> <span class="n">VL</span><span class="o">*</span>  <span class="n">unit</span><span class="o">-</span><span class="n">stride</span>
 <span class="n">nf</span>  <span class="o">|</span> <span class="n">mop</span> <span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>   <span class="n">rs2</span>    <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">0000111</span><span class="o">|</span> <span class="n">VLS</span><span class="o">*</span> <span class="n">strided</span>
 <span class="n">nf</span>  <span class="o">|</span> <span class="n">mop</span> <span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">0000111</span><span class="o">|</span> <span class="n">VLX</span><span class="o">*</span> <span class="n">indexed</span>
  <span class="mi">3</span>     <span class="mi">3</span>     <span class="mi">1</span>      <span class="mi">5</span>           <span class="mi">5</span>         <span class="mi">3</span>         <span class="mi">5</span>       <span class="mi">7</span>

<span class="n">STORE</span><span class="o">-</span><span class="n">FPメジャーオペコードを使用を使用したベクトルストア命令のフォーマット</span>
<span class="mi">31</span> <span class="mi">29</span> <span class="mi">28</span> <span class="mi">26</span>  <span class="mi">25</span>  <span class="mi">24</span>      <span class="mi">20</span> <span class="mi">19</span>       <span class="mi">15</span> <span class="mi">14</span>   <span class="mi">12</span> <span class="mi">11</span>      <span class="mi">7</span> <span class="mi">6</span>     <span class="mi">0</span>
 <span class="n">nf</span>  <span class="o">|</span> <span class="n">mop</span> <span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>  <span class="n">sumop</span>   <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span>   <span class="n">vs3</span>   <span class="o">|</span><span class="mi">0100111</span><span class="o">|</span> <span class="n">VS</span><span class="o">*</span>  <span class="n">unit</span><span class="o">-</span><span class="n">stride</span>
 <span class="n">nf</span>  <span class="o">|</span> <span class="n">mop</span> <span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>   <span class="n">rs2</span>    <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span>   <span class="n">vs3</span>   <span class="o">|</span><span class="mi">0100111</span><span class="o">|</span> <span class="n">VSS</span><span class="o">*</span> <span class="n">strided</span>
 <span class="n">nf</span>  <span class="o">|</span> <span class="n">mop</span> <span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span>   <span class="n">vs3</span>   <span class="o">|</span><span class="mi">0100111</span><span class="o">|</span> <span class="n">VSX</span><span class="o">*</span> <span class="n">indexed</span>
  <span class="mi">3</span>     <span class="mi">3</span>     <span class="mi">1</span>      <span class="mi">5</span>           <span class="mi">5</span>         <span class="mi">3</span>         <span class="mi">5</span>        <span class="mi">7</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AMOメジャーオペコードを使用したベクトルAMO命令のフォーマット</span>
<span class="mi">31</span>    <span class="mi">27</span> <span class="mi">26</span>  <span class="mi">25</span>  <span class="mi">24</span>      <span class="mi">20</span> <span class="mi">19</span>       <span class="mi">15</span> <span class="mi">14</span>   <span class="mi">12</span> <span class="mi">11</span>      <span class="mi">7</span> <span class="mi">6</span>     <span class="mi">0</span>
 <span class="n">amoop</span>  <span class="o">|</span><span class="n">wd</span><span class="o">|</span> <span class="n">vm</span> <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">rs1</span>    <span class="o">|</span> <span class="n">width</span> <span class="o">|</span> <span class="n">vs3</span><span class="o">/</span><span class="n">vd</span>  <span class="o">|</span><span class="mi">0101111</span><span class="o">|</span> <span class="n">VAMO</span><span class="o">*</span>
   <span class="mi">5</span>      <span class="mi">1</span>   <span class="mi">1</span>      <span class="mi">5</span>           <span class="mi">5</span>         <span class="mi">3</span>        <span class="mi">5</span>        <span class="mi">7</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OP</span><span class="o">-</span><span class="n">Vメジャーオペコードを使用したベクトル算術演算のフォーマット</span>

<span class="mi">31</span>       <span class="mi">26</span>  <span class="mi">25</span>   <span class="mi">24</span>      <span class="mi">20</span> <span class="mi">19</span>      <span class="mi">15</span> <span class="mi">14</span>   <span class="mi">12</span> <span class="mi">11</span>      <span class="mi">7</span> <span class="mi">6</span>     <span class="mi">0</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">vs1</span>   <span class="o">|</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPIVV</span><span class="p">)</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">vs1</span>   <span class="o">|</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="o">|</span>  <span class="n">vd</span><span class="o">/</span><span class="n">rd</span>  <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPFVV</span><span class="p">)</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">vs1</span>   <span class="o">|</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="o">|</span>  <span class="n">vd</span><span class="o">/</span><span class="n">rd</span>  <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPMVV</span><span class="p">)</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>   <span class="n">simm5</span>  <span class="o">|</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPIVI</span><span class="p">)</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">rs1</span>   <span class="o">|</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPIVX</span><span class="p">)</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">rs1</span>   <span class="o">|</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="o">|</span>    <span class="n">vd</span>   <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPFVF</span><span class="p">)</span>
  <span class="n">funct6</span>   <span class="o">|</span> <span class="n">vm</span>  <span class="o">|</span>   <span class="n">vs2</span>    <span class="o">|</span>    <span class="n">rs1</span>   <span class="o">|</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="o">|</span>  <span class="n">vd</span><span class="o">/</span><span class="n">rd</span>  <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">OP</span><span class="o">-</span><span class="n">V</span> <span class="p">(</span><span class="n">OPMVX</span><span class="p">)</span>
     <span class="mi">6</span>        <span class="mi">1</span>        <span class="mi">5</span>          <span class="mi">5</span>        <span class="mi">3</span>        <span class="mi">5</span>        <span class="mi">7</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OP</span><span class="o">-</span><span class="n">Vメジャーオペコードを使用したベクトルコンフィグレーションのフォーマット</span>

 <span class="mi">31</span> <span class="mi">30</span>         <span class="mi">25</span> <span class="mi">24</span>      <span class="mi">20</span> <span class="mi">19</span>      <span class="mi">15</span> <span class="mi">14</span>   <span class="mi">12</span> <span class="mi">11</span>      <span class="mi">7</span> <span class="mi">6</span>     <span class="mi">0</span>
 <span class="mi">0</span> <span class="o">|</span>        <span class="n">zimm</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>      <span class="o">|</span>    <span class="n">rs1</span>   <span class="o">|</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">|</span>    <span class="n">rd</span>   <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">vsetvli</span>
 <span class="mi">1</span> <span class="o">|</span>   <span class="mi">000000</span>    <span class="o">|</span>   <span class="n">rs2</span>    <span class="o">|</span>    <span class="n">rs1</span>   <span class="o">|</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">|</span>    <span class="n">rd</span>   <span class="o">|</span><span class="mi">1010111</span><span class="o">|</span> <span class="n">vsetvl</span>
 <span class="mi">1</span>        <span class="mi">6</span>            <span class="mi">5</span>          <span class="mi">5</span>        <span class="mi">3</span>        <span class="mi">5</span>        <span class="mi">7</span>
</pre></div>
</div>
<p>ベクトル命令はスカラオペランドとベクトルソースオペランドを持つことができ、スカラとベクトルの両方の結果を出力することができる。ほとんどのベクトル命令は無条件で動作するか、マスクに基づいて条件的に動作する。</p>
<p>ベクトルロードストア命令はレジスタ要素とメモリの間でビットパタンを移動する。ベクトル算術演算はベクトルレジスタ要素の値を演算する。</p>
<div class="section" id="id5">
<h2>5.1. スカラオペランド<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>スカラオペランドは、即値、<code class="docutils literal notranslate"><span class="pre">X</span></code>整数レジスタ、<code class="docutils literal notranslate"><span class="pre">f</span></code>浮動小数点レジスタ、ベクトルの要素0レジスタを取ることができる。スカラの結果は<code class="docutils literal notranslate"><span class="pre">X</span></code>,
`f,
もしくはベクトルレジスタの要素0番目に書き込まれる。LMULのセッティングに関係なく、どのようなベクトルレジスタもスカラの値を保持することができる。</p>
<blockquote>
<div>0.6からの仕様変更として、浮動小数点レジスタはベクトルレジスタとオーバレイしなくなった点と、スカラの要素嘘として整数と浮動小数点レジスタを取ることができるということが挙げられる。<code class="docutils literal notranslate"><span class="pre">f</span></code>レジスタとのオーバレイの仕様を削除したことにより、ベクトルレジスタのレジスタプレッシャの問題を削減し、標準的な呼び出し規約での相互干渉を避けることができる。また、高性能スカラ浮動小数点演算命令において実装を簡単化する。また、Zfinx
ISAとの互換性をサポートする。<code class="docutils literal notranslate"><span class="pre">f</span></code>レジスタを<code class="docutils literal notranslate"><span class="pre">v</span></code>レジスタとオーバレイすることのメリットはいくつかの実装で状態ビットの数を削減することができるが、高性能な設計では実装が複雑化し、Zfinxオプションでの処理が複雑化する。</div></blockquote>
</div>
<div class="section" id="id6">
<h2>5.2. ベクトルオペランド<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトルオペランド・ベクトル演算結果はLMULに基づいて1つ以上のベクトルレジスタを使用するが、常にグループ内の最小ベクトルレジスタアドレスを使用する。最小ベクトルレジスタアドレス以外を使用すると、不定命令例外を発生する。</p>
<p>いくつかのベクトル命令はより幅の長い要素を読み込むか書き込みを行い、<code class="docutils literal notranslate"><span class="pre">vlmul</span></code>で指定されたレジスタグループよりもより多くのベクトルレジスタグループを使用することがある。最大のベクトルレジスタグループは8を超える事は無く、もしベクトル命令が8よりも大きなレジスタグループを必要とするならば、その命令は不定命令例外が発生する。例えば、LMUL=8でより幅の広いレジスタを使用する命令を実行した場合、不定命令例外が発生する。</p>
</div>
<div class="section" id="id7">
<h2>5.3 ベクトルマスク<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>多くのベクトル命令ではマスクイングをサポートしている。マスクされた要素に対する演算は、書き込みレジスタ要素の値を更新せず、例外も発生しない。</p>
<p>ベースレジスタ拡張では、マスクの値はマスク付きベクトル命令によって使用され、マスクの値は常にベクトルレジスタ<code class="docutils literal notranslate"><span class="pre">v0</span></code>から与えられる。各要素の再開ビットが制御命令のマスクベクタとして使用される。</p>
<blockquote>
<div>将来のベクトル拡張では、マスクレジスタとしてすべての空間を利用できるような長い命令エンコーディングを提供する予定である。</div></blockquote>
<p>マスク付きベクトル命令の書き込みレジスタグループは、LMUL=1の時のみおーばラップすることができる。それ以外の場合は不定命令例外が発生する。</p>
<blockquote>
<div>この制約では、非ゼロの<code class="docutils literal notranslate"><span class="pre">vstart</span></code>値による再開がサポートされる。</div></blockquote>
<p>他のベクトルレジスタは計算中のマスクを保持することができ、プレディケートの計算のためにベクトル論理演算などを適用できる。</p>
<div class="section" id="id8">
<h3>5.3.1. マスクのエンコーディング<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>マスクが使用可能な場合、命令中の<code class="docutils literal notranslate"><span class="pre">inst[25]</span></code>に配置されている<code class="docutils literal notranslate"><span class="pre">vm</span></code>1ビットとしてエンコードされる。</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">vm</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>vector result, only where v0[i].LSB = 1</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>unmasked</td>
</tr>
</tbody>
</table>
<blockquote>
<div>初期の仕様では、<code class="docutils literal notranslate"><span class="pre">vm</span></code>は2ビットであり<code class="docutils literal notranslate"><span class="pre">vm[1:0]</span></code>とし、スカラ命令と同様に<code class="docutils literal notranslate"><span class="pre">v0</span></code>を使用して双方とも1もしくは排他的なマスクをサポートしていた。</div></blockquote>
<p>ベクトルのマスクはアセンブラコードでは追加のベクトルオペランドとして表現される。<code class="docutils literal notranslate"><span class="pre">.t</span></code>は<code class="docutils literal notranslate"><span class="pre">v0[i].LSB</span></code>が1である場合に演算が発生する。マスクが指定されていないと、マスク無しベクトル命令(<code class="docutils literal notranslate"><span class="pre">vm=1</span></code>)として演算が実行される。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vop</span><span class="o">.</span><span class="n">v</span><span class="o">*</span>    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v0</span><span class="o">.</span><span class="n">t</span>  <span class="c1"># enabled where v0[i].LSB=1, m=0</span>
<span class="n">vop</span><span class="o">.</span><span class="n">v</span><span class="o">*</span>    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span>        <span class="c1"># unmasked vector operation, m=1</span>
</pre></div>
</div>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">v0</span></code>によるTrueの形のプレディケーションをベクトルマスクレジスタをサポートしているにも関わらず、アセンブリの構文ではマスクレジスタの指定としてすべてのベクトルレジスタを指定でき、Both
Trueと排他的なマスクをサポートできるように設計している。<code class="docutils literal notranslate"><span class="pre">.t</span></code>はマスクの仕様を視覚的にエンコードすることを助ける。</div></blockquote>
</div>
</div>
<div class="section" id="id9">
<h2>5.4 プリスタート・アクティブ・インアクティブ・ボディー・テールの要素定義<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトル命令を実行中に、演算が適用される要素は以下の4つの別々の状態に分類される。</p>
<ul class="simple">
<li><strong>プリスタート(prestart)</strong>
要素は、その要素のインデックが<code class="docutils literal notranslate"><span class="pre">vstart</span></code>に格納されている初期値よりも小さいものを指す。プリスタート状態の要素は例外を発生させず、書き込みレジスタに指定されても要素のアップデートは行われない。</li>
<li><strong>アクティブ(active)</strong>要素は現在のベクトル長の設定に含まれているベクトル要素であり、現在のマスク設定により有効化されている要素である。アクティブな要素は例外を発生する可能性があり、書き込みベクトルレジスタグループにより書き込みが発生する可能性がある。</li>
<li><strong>インアクティブ(inactive)</strong>な要素は現在のベクトル長の設定に含まれているベクトル要素であるが、現在のマスクそっていにより有効化されていないベクトル要素である。インアクティブな要素は例外を発生させず、書き込みレジスタに指定されても書き込みが行われない。</li>
<li><strong>テール(tail)</strong>要素はベクトル命令の実行中に、現在のベクトル長の設定よりも後ろのベクトル要素である。テールのベクトル要素は例外を発生させないが、ベクトルレジスタグループにおいて書き込み時はゼロが書き込まれる。</li>
<li>加えて、他の要素として<strong>ボディー(body)</strong>要素は、アクティブ要素とインアクティブ要素の両方を示したものである。つまり、プリスタート以降で、テール以前の要素を指す。</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ベクトル要素のインデックス xについて、
プリスタート     = (0 &lt;= x &lt; vstart)
mask(x)        = unmasked || v0[x].LSB == 1
アクティブ(x)    = (vstart &lt;= x &lt; vl) &amp;&amp; mask(x)
インアクティブ(x) = (vstart &lt;= x &lt; vl) &amp;&amp; !mask(x)
ボディー(x)      = active(x) || inactive(x)
テール(x)        = (vl &lt;= x &lt; VLMAX)
</pre></div>
</div>
<p>All regular vector instructions place zeros in the tail elements of the
destination vector register group. Some vector arithmetic instructions
are not maskable, so have no inactive elements, but still zero the tail
elements.</p>
<p>すべての通常ベクトル命令は、書き込みレジスタのテール要素に対してゼロを書き込む。いくつかのベクトル算術演算はマスク不可能であり、したがってインアクティブな要素は存在しないが、テール要素についてはゼロを書き込む。</p>
<blockquote>
<div>インアクティブとテール要素のアップデートルールは、実装の要求とベクトルレジスタのECCの問題およびリネーミングに関する問題の妥協案として設計されている。</div></blockquote>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">vl</span></code>以降のレジスタをゼロ埋めしないと、リネーミングを行う実装において悪影響があり、すべての命令においてVL以降のすべての要素をコピーする必要がある。一方でリネーミングを行わない実装ではテールのゼロ化を行うことのペナルティは小さい。リネーミングを行う実装では、リネーミングを行わないことですべてのベクトルレジスタのコピーを避けることができ、各レジスタの演算が、任意のベクトル長に対してすべての帯域を占有してしまうだけに十分深くなってしまうことが問題である。<code class="docutils literal notranslate"><span class="pre">vl</span></code>以降の値をすべてゼロで埋めてしまうことにより、ほとんどのソフトウェアの影響を削減するが、リダクション捜査の場合にも若干のコストが発生する。</p>
<p>For zeroing tail updates, implementations with temporally long vector
registers, either with or without register renaming, will be
motivated to add microarchitectural state to avoid actually writing
zeros to all tail elements, but this is a relatively simple
microarchitectural optimization. For example, one bit per element
group or a quantized VL can be used to track the extent of zeroing.
An element group is the set of elements comprising the smallest
atomic unit of execution in the microarchitecture (often equivalent
to the width of the physical datapath in the machine). The
microarchitectural state for an element group indicates that zero
should be returned for the element group on a read, and that zero
should be substituted in for any masked-off elements in the group on
the first write to that element group (after which the element group
zero bit can be cleared).</p>
<p>テール意向をゼロに埋めるために、一時的に長いベクトルレジスタを使用する実装では、レジスタのリネーミングの有無にかかわらず、実際にゼロを書き込む操作を割くるために新たなマイクロアーキテクチャの状態を追加することも考えられるが、これは比較的単純なマイクロアーキテクチャの最適化である。例えば、要素グループ毎に1ビット、もしくは量子化されたVLによりゼロ埋めを行う範囲を追跡することができる。要素グループは、マイクロアーキテクチャの実行の最小アトミックユニット単位(多くの場合、マシンの物理データパスのサイズと同じ)を構成する要素のセットとなる。要素グループのマイクロアーキテクチャの状態は、読み出し時には要素グループにゼロが返され、マスクされた要素に対する書き込みは、最初の書き込み時にグループ内のマスクされた要素にゼロを代入されることを示す(その後、要素グループのゼロビットはクリアできる)。</p>
</div></blockquote>
<blockquote>
<div><p>Providing merging predication instead of zeroing inactive elements on
a masked operation reduces code path length for many code blocks, and
reduces register pressure by allowing different code paths to use
disjoint sets of elements in the same vector register.
Implementations with vector register ECC or renaming will have to
perform read-update-write on the destination register value to
preserve inactive elements on arithmetic instructions, so would
appear to need an extra vector register read port. However, the
arithmetic instructions are designed such that the largest read-port
requirement is for fused multiply-add instructions that are
destructive and overwrite one source, and hence do not need an extra
read port to preserve inactive elements. Given that linear algebra is
one of the more important applications for vector units, and that
fused multiply-add is the dominant operation in linear algebra
routines, microarchitectures will be optimized for fused multiply-add
operations and so should be able to preserve inactive elements on
other arithmetic operations without large additional cost. However,
masked vector load instructions incur the cost of an additional read
port on their destination register. The need to support resumable
vector loads with non-zero <code class="docutils literal notranslate"><span class="pre">vstart</span></code> values also drives the need to
preserve vector load destination register values. The AMOs have been
defined to be destructive in their source operand to reduce the
maximum read port requirement for the memory pipe. An option that was
considered was to have loads behave differently from arithmetic
instructions and to zero any masked-off elements. However, this would
require additional instructions and increase register pressure, and
vector loads must in any case still cope with non-zero <code class="docutils literal notranslate"><span class="pre">vstart</span></code>
values through some mechanism.</p>
<p>マスクされたインアクティブな要素をゼロ埋めする方法の代わりに、マージプレディケートを実装することにより、多くのコードブロックのコードパスの長さが短くなり、異なるコードパスが同じベクトルレジスタ内の要素の異なる要素の集合を使用できるため、レジスタプレッシを軽減することができる。ベクトルレジスタのECC、もしくはリネーミングを使用する実装では、算術命令のインアクティブな要素を保持するために、読み取り/更新/書き込みを実行する必要あり、ベクトルレジスタの読み取りポートを増やす必要がある。ただし、算術命令は、最大の読み取りポート数が1つのソースを上書きするFused積和命令であるように設計されているため、インアクティブな要素を保持するための追加の読み取りポートは必要ない。線形代数はベクトル単位のより重要なアプリケーションの1つであり、線形積和が線形代数ルーチンの主要な演算であるため、マイクロアーキテクチャはFused積和演算に対して最適化され、インアクティブな要素を保持できるはずである。大きな追加コストなしで他の算術演算も実装できる。ただし、マスクされたベクトルロード命令では、デスティネーションレジスタに追加の読み取りポートのコストが発生する。ゼロ以外の<code class="docutils literal notranslate"><span class="pre">vstart</span></code>値でリジューム可能なベクトルロードをサポートする必要性があり、ベクトルロードデスティネーションレジスタ値を保持する必要性も発生する。
AMOは、メモリパイプの最大リードポートの数を減らすために、ソースオペランドを上書きするように設計されている。ほかの方法として考えられたものは、算術命令とは異なる動作をロードに与え、マスクされた要素をゼロにすることであった。しかしこの方法では追加の命令が必要であり、レジスターのプレッシャーが増加する。ベクタロードは、いずれの場合でも、何らかのメカニズムを介してゼロ以外の<code class="docutils literal notranslate"><span class="pre">vstart</span></code>値に対処する必要がある。</p>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chapter5_vector_instruction_format.html" class="btn btn-neutral float-right" title="5. ベクトル命令フォーマット" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chapter1_3_riscv_vector_insts.html" class="btn btn-neutral float-left" title="RISC-V “V” Extension" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, msyksphinz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>